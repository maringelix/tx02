name: ðŸ’¥ Destroy Infrastructure

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to destroy'
        required: true
        type: choice
        options:
          - prd
          - stg
      destroy_bootstrap:
        description: 'Also destroy Terraform backend (Storage Account)?'
        required: true
        type: boolean
        default: false
      confirm:
        description: 'Type "destroy" to confirm'
        required: true

env:
  TF_VERSION: '1.6.0'
  RESOURCE_GROUP: terraform-state-rg
  STORAGE_ACCOUNT: tfstatetx02

jobs:
  validate:
    name: ðŸ” Validate Destroy Request
    runs-on: ubuntu-latest
    
    steps:
      - name: Validate confirmation
        if: github.event.inputs.confirm != 'destroy'
        run: |
          echo "âŒ Confirmation failed. You must type 'destroy' to proceed."
          exit 1
      
      - name: Show what will be destroyed
        run: |
          echo "## âš ï¸ Destroy Plan" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Environment:** ${{ github.event.inputs.environment }}" >> $GITHUB_STEP_SUMMARY
          echo "**Destroy Bootstrap:** ${{ github.event.inputs.destroy_bootstrap }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ—‘ï¸ Resources to be destroyed:" >> $GITHUB_STEP_SUMMARY
          echo "- AKS Cluster (tx02-${{ github.event.inputs.environment }}-aks)" >> $GITHUB_STEP_SUMMARY
          echo "- Azure Container Registry (tx02${{ github.event.inputs.environment }}acr)" >> $GITHUB_STEP_SUMMARY
          echo "- Virtual Network" >> $GITHUB_STEP_SUMMARY
          echo "- Network Security Groups" >> $GITHUB_STEP_SUMMARY
          echo "- Resource Group (tx02-${{ github.event.inputs.environment }}-rg)" >> $GITHUB_STEP_SUMMARY
          echo "- **Backups:** Disk snapshots and SQL Database LTR backups" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ github.event.inputs.destroy_bootstrap }}" == "true" ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸ”¥ ALSO DESTROYING TERRAFORM BACKEND:" >> $GITHUB_STEP_SUMMARY
            echo "- Storage Account (tfstatetx02)" >> $GITHUB_STEP_SUMMARY
            echo "- Resource Group (terraform-state-rg)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ **WARNING: You will need to run bootstrap workflow again!**" >> $GITHUB_STEP_SUMMARY
          fi

  cleanup-backups:
    name: ðŸ—‘ï¸ Cleanup Backups
    runs-on: ubuntu-latest
    needs: validate
    
    steps:
      - name: Extract Azure Credentials
        id: azure-creds
        run: |
          echo "CLIENT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientId')" >> $GITHUB_OUTPUT
          echo "CLIENT_SECRET=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientSecret')" >> $GITHUB_OUTPUT
          echo "TENANT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.tenantId')" >> $GITHUB_OUTPUT
          echo "SUBSCRIPTION_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.subscriptionId')" >> $GITHUB_OUTPUT
      
      - name: Azure CLI Login
        run: |
          az login --service-principal \
            -u "${{ steps.azure-creds.outputs.CLIENT_ID }}" \
            -p "${{ steps.azure-creds.outputs.CLIENT_SECRET }}" \
            --tenant "${{ steps.azure-creds.outputs.TENANT_ID }}"
          az account set --subscription "${{ steps.azure-creds.outputs.SUBSCRIPTION_ID }}"
          echo "âœ… Logged in to Azure"
      
      - name: Delete disk snapshots
        continue-on-error: true
        run: |
          echo "ðŸ—‘ï¸ Deleting disk snapshots tagged with Project=tx02..."
          
          # Find all snapshots with Project=tx02 tag
          SNAPSHOTS=$(az snapshot list \
            --query "[?tags.Project=='tx02'].{Name: name, RG: resourceGroup}" \
            --output json)
          
          SNAPSHOT_COUNT=$(echo "$SNAPSHOTS" | jq '. | length')
          
          if [ "$SNAPSHOT_COUNT" -eq 0 ]; then
            echo "â„¹ï¸ No snapshots found with Project=tx02 tag"
          else
            echo "Found $SNAPSHOT_COUNT snapshot(s) to delete"
            
            echo "$SNAPSHOTS" | jq -c '.[]' | while read snapshot; do
              SNAPSHOT_NAME=$(echo $snapshot | jq -r '.Name')
              SNAPSHOT_RG=$(echo $snapshot | jq -r '.RG')
              
              echo "  Deleting snapshot: $SNAPSHOT_NAME"
              az snapshot delete \
                --name "$SNAPSHOT_NAME" \
                --resource-group "$SNAPSHOT_RG" \
                --yes \
                --no-wait
            done
            
            echo "âœ… Snapshot deletion initiated for $SNAPSHOT_COUNT snapshot(s)"
          fi
      
      - name: Delete SQL Database LTR backups
        continue-on-error: true
        run: |
          echo "ðŸ—‘ï¸ Checking for SQL Database LTR backups..."
          
          SQL_SERVER="tx02-${{ github.event.inputs.environment }}-sql"
          SQL_DB="tx02-${{ github.event.inputs.environment }}-db"
          LOCATION="westus2"
          
          # Check if SQL server exists
          if ! az sql server show --name "$SQL_SERVER" --resource-group tx02-${{ github.event.inputs.environment }}-rg &>/dev/null; then
            echo "â„¹ï¸ SQL Server not found, skipping LTR backup cleanup"
            exit 0
          fi
          
          # List LTR backups
          LTR_BACKUPS=$(az sql db ltr-backup list \
            --location "$LOCATION" \
            --server "$SQL_SERVER" \
            --database "$SQL_DB" \
            --resource-group tx02-${{ github.event.inputs.environment }}-rg \
            --output json 2>/dev/null || echo "[]")
          
          BACKUP_COUNT=$(echo "$LTR_BACKUPS" | jq '. | length')
          
          if [ "$BACKUP_COUNT" -eq 0 ]; then
            echo "â„¹ï¸ No LTR backups found"
          else
            echo "Found $BACKUP_COUNT LTR backup(s) to delete"
            
            echo "$LTR_BACKUPS" | jq -c '.[]' | while read backup; do
              BACKUP_NAME=$(echo $backup | jq -r '.name')
              
              echo "  Deleting LTR backup: $BACKUP_NAME"
              az sql db ltr-backup delete \
                --location "$LOCATION" \
                --server "$SQL_SERVER" \
                --database "$SQL_DB" \
                --name "$BACKUP_NAME" \
                --resource-group tx02-${{ github.event.inputs.environment }}-rg \
                --yes
            done
            
            echo "âœ… Deleted $BACKUP_COUNT LTR backup(s)"
          fi
      
      - name: Backup cleanup summary
        run: |
          echo "## ðŸ—‘ï¸ Backup Cleanup Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- Disk snapshots: Deleted (tagged with Project=tx02)" >> $GITHUB_STEP_SUMMARY
          echo "- SQL LTR backups: Deleted" >> $GITHUB_STEP_SUMMARY
          echo "- SQL PITR backups: Will be deleted with database" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "â„¹ï¸ Note: Short-term backups (PITR) are automatically deleted when the database is destroyed" >> $GITHUB_STEP_SUMMARY

  destroy-infrastructure:
    name: ðŸ’¥ Destroy Infrastructure
    runs-on: ubuntu-latest
    needs: [validate, cleanup-backups]
    
    environment:
      name: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
          terraform_wrapper: false
      
      - name: Extract Azure Credentials
        id: azure-creds
        run: |
          echo "CLIENT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientId')" >> $GITHUB_OUTPUT
          echo "CLIENT_SECRET=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientSecret')" >> $GITHUB_OUTPUT
          echo "TENANT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.tenantId')" >> $GITHUB_OUTPUT
          echo "SUBSCRIPTION_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.subscriptionId')" >> $GITHUB_OUTPUT
      
      - name: Azure CLI Login
        run: |
          az login --service-principal \
            -u "${{ steps.azure-creds.outputs.CLIENT_ID }}" \
            -p "${{ steps.azure-creds.outputs.CLIENT_SECRET }}" \
            --tenant "${{ steps.azure-creds.outputs.TENANT_ID }}"
          
          az account set --subscription "${{ steps.azure-creds.outputs.SUBSCRIPTION_ID }}"
          
          echo "âœ… Logged in to Azure"
          az account show
      
      - name: Check Current Resources
        run: |
          echo "ðŸ” Checking current resources..."
          
          # Check AKS
          if az aks show --resource-group tx02-${{ github.event.inputs.environment }}-rg --name tx02-${{ github.event.inputs.environment }}-aks &>/dev/null; then
            echo "âœ… Found AKS cluster"
          else
            echo "âš ï¸ AKS cluster not found"
          fi
          
          # Check ACR
          if az acr show --resource-group tx02-${{ github.event.inputs.environment }}-rg --name tx02${{ github.event.inputs.environment }}acr &>/dev/null; then
            echo "âœ… Found ACR"
          else
            echo "âš ï¸ ACR not found"
          fi
          
          # Check Resource Group
          if az group show --name tx02-${{ github.event.inputs.environment }}-rg &>/dev/null; then
            echo "âœ… Found Resource Group"
          else
            echo "âš ï¸ Resource Group not found"
          fi
      
      - name: Terraform Init
        run: terraform init
        working-directory: terraform/${{ github.event.inputs.environment }}
        env:
          ARM_CLIENT_ID: ${{ steps.azure-creds.outputs.CLIENT_ID }}
          ARM_CLIENT_SECRET: ${{ steps.azure-creds.outputs.CLIENT_SECRET }}
          ARM_SUBSCRIPTION_ID: ${{ steps.azure-creds.outputs.SUBSCRIPTION_ID }}
          ARM_TENANT_ID: ${{ steps.azure-creds.outputs.TENANT_ID }}
          ARM_ACCESS_KEY: ${{ secrets.AZURE_STORAGE_ACCESS_KEY }}
      
      - name: Terraform Destroy
        run: terraform destroy -auto-approve
        working-directory: terraform/${{ github.event.inputs.environment }}
        env:
          ARM_CLIENT_ID: ${{ steps.azure-creds.outputs.CLIENT_ID }}
          ARM_CLIENT_SECRET: ${{ steps.azure-creds.outputs.CLIENT_SECRET }}
          ARM_SUBSCRIPTION_ID: ${{ steps.azure-creds.outputs.SUBSCRIPTION_ID }}
          ARM_TENANT_ID: ${{ steps.azure-creds.outputs.TENANT_ID }}
          ARM_ACCESS_KEY: ${{ secrets.AZURE_STORAGE_ACCESS_KEY }}
          TF_VAR_project_name: tx02
          TF_VAR_environment: ${{ github.event.inputs.environment }}
          TF_VAR_location: eastus
          TF_VAR_vnet_address_space: '["10.0.0.0/16"]'
          TF_VAR_subnet_aks: 10.0.1.0/24
          TF_VAR_subnet_database: 10.0.2.0/24
          TF_VAR_subnet_vm: 10.0.3.0/24
          TF_VAR_subnet_appgw: 10.0.4.0/24
          TF_VAR_use_aks: true
          TF_VAR_aks_node_count: 2
          TF_VAR_aks_min_count: 2
          TF_VAR_aks_max_count: 10
          TF_VAR_aks_node_size: Standard_D2s_v3
          TF_VAR_kubernetes_version: "1.32"
          TF_VAR_db_sku_name: Basic
          TF_VAR_db_storage_gb: 2
          TF_VAR_db_version: "17"
          TF_VAR_db_admin_username: dx02admin
          TF_VAR_db_name: dx02_db
          TF_VAR_db_password: ${{ secrets.TF_VAR_db_password }}
          TF_VAR_vm_size: Standard_D2s_v3
          TF_VAR_vm_admin_username: azureuser
          TF_VAR_vm_admin_password: ${{ secrets.TF_VAR_admin_password }}
          TF_VAR_acr_sku: Basic
          TF_VAR_tags: '{"Project":"TX02","Environment":"Production","ManagedBy":"Terraform"}'
      
      - name: Cleanup AKS Managed Resource Group
        continue-on-error: true
        run: |
          echo "ðŸ§¹ Cleaning up AKS managed resource group..."
          
          AKS_MC_RG="MC_tx02-${{ github.event.inputs.environment }}-rg_tx02-${{ github.event.inputs.environment }}-aks_eastus"
          
          if az group show --name "$AKS_MC_RG" &>/dev/null; then
            echo "âš ï¸ AKS managed resource group still exists, forcing deletion..."
            
            # Delete all resources in the managed RG first
            az resource list --resource-group "$AKS_MC_RG" --query "[].id" -o tsv | \
              xargs -I {} az resource delete --ids {} --verbose || true
            
            # Then delete the resource group
            az group delete --name "$AKS_MC_RG" --yes --no-wait
            
            echo "âœ… AKS managed resource group cleanup initiated"
          else
            echo "âœ… AKS managed resource group already deleted"
          fi
      
      - name: Force Delete Remaining Resources
        continue-on-error: true
        run: |
          echo "ðŸ§¹ Force deleting any remaining resources in tx02-${{ github.event.inputs.environment }}-rg..."
          
          RESOURCE_GROUP="tx02-${{ github.event.inputs.environment }}-rg"
          
          if ! az group show --name "$RESOURCE_GROUP" &>/dev/null; then
            echo "âœ… Resource group already deleted"
            exit 0
          fi
          
          # Get all remaining resources
          REMAINING=$(az resource list --resource-group "$RESOURCE_GROUP" --query "[].{Name:name, Type:type}" -o json)
          RESOURCE_COUNT=$(echo "$REMAINING" | jq '. | length')
          
          if [ "$RESOURCE_COUNT" -eq 0 ]; then
            echo "âœ… No remaining resources to delete"
          else
            echo "âš ï¸ Found $RESOURCE_COUNT remaining resource(s), force deleting..."
            echo "$REMAINING" | jq -r '.[] | "  - \(.Name) (\(.Type))"'
            
            # Force delete Application Gateway first (takes longest)
            echo ""
            echo "ðŸ—‘ï¸ Deleting Application Gateway..."
            az network application-gateway delete \
              --resource-group "$RESOURCE_GROUP" \
              --name "tx02-${{ github.event.inputs.environment }}-appgw" \
              --no-wait 2>/dev/null || echo "  (not found or already deleted)"
            
            # Delete WAF Policy
            echo "ðŸ—‘ï¸ Deleting WAF Policy..."
            az network application-gateway waf-policy delete \
              --resource-group "$RESOURCE_GROUP" \
              --name "tx02-${{ github.event.inputs.environment }}-appgw-waf-policy" \
              2>/dev/null || echo "  (not found or already deleted)"
            
            # Delete Application Insights
            echo "ðŸ—‘ï¸ Deleting Application Insights..."
            az monitor app-insights component delete \
              --resource-group "$RESOURCE_GROUP" \
              --app "tx02-${{ github.event.inputs.environment }}-appinsights" \
              --yes 2>/dev/null || echo "  (not found or already deleted)"
            
            # Delete Container Insights Solution
            echo "ðŸ—‘ï¸ Deleting Container Insights..."
            az resource delete \
              --resource-group "$RESOURCE_GROUP" \
              --name "ContainerInsights(tx02-${{ github.event.inputs.environment }}-logs)" \
              --resource-type "Microsoft.OperationsManagement/solutions" \
              2>/dev/null || echo "  (not found or already deleted)"
            
            # Delete Action Group
            echo "ðŸ—‘ï¸ Deleting Action Group..."
            az monitor action-group delete \
              --resource-group "$RESOURCE_GROUP" \
              --name "Application Insights Smart Detection" \
              2>/dev/null || echo "  (not found or already deleted)"
            
            # Delete Public IPs
            echo "ðŸ—‘ï¸ Deleting Public IPs..."
            az network public-ip list --resource-group "$RESOURCE_GROUP" --query "[].name" -o tsv | \
              xargs -I {} az network public-ip delete --resource-group "$RESOURCE_GROUP" --name {} --no-wait 2>/dev/null || true
            
            # Wait for App Gateway to be deleted before deleting VNet
            echo "â³ Waiting for Application Gateway deletion..."
            sleep 60
            
            # Delete Virtual Network (must be last)
            echo "ðŸ—‘ï¸ Deleting Virtual Network..."
            az network vnet delete \
              --resource-group "$RESOURCE_GROUP" \
              --name "tx02-${{ github.event.inputs.environment }}-vnet" \
              2>/dev/null || echo "  (not found or already deleted)"
            
            echo "âœ… Force deletion completed"
          fi
      
      - name: Delete Resource Group
        continue-on-error: true
        run: |
          echo "ðŸ—‘ï¸ Deleting resource group tx02-${{ github.event.inputs.environment }}-rg..."
          
          if az group show --name tx02-${{ github.event.inputs.environment }}-rg &>/dev/null; then
            # List remaining resources before deletion
            echo "ðŸ“‹ Remaining resources before RG deletion:"
            az resource list --resource-group tx02-${{ github.event.inputs.environment }}-rg --query "[].name" -o tsv || true
            
            # Force delete the entire resource group
            az group delete \
              --name tx02-${{ github.event.inputs.environment }}-rg \
              --yes \
              --no-wait
            
            echo "âœ… Resource group deletion initiated"
          else
            echo "âœ… Resource group already deleted"
          fi
      
      - name: Verify Destruction
        run: |
          echo "ðŸ” Verifying resource destruction..."
          
          echo "â³ Waiting 30 seconds for resource group deletion to propagate..."
          sleep 30
          
          if az group show --name tx02-${{ github.event.inputs.environment }}-rg &>/dev/null; then
            echo "âš ï¸ Resource Group still exists (deletion in progress)"
            echo "   This is normal - deletion can take several minutes"
            
            # Check remaining resources
            REMAINING=$(az resource list --resource-group tx02-${{ github.event.inputs.environment }}-rg --query "[].name" -o tsv 2>/dev/null || echo "")
            if [ -n "$REMAINING" ]; then
              echo "   Remaining resources:"
              echo "$REMAINING" | sed 's/^/     - /'
            fi
          else
            echo "âœ… Resource Group successfully destroyed"
          fi
          
          # Check all resource groups
          echo ""
          echo "ðŸ“‹ Remaining resource groups:"
          az group list --query "[].name" -o table
      
      - name: Summary
        run: |
          echo "## âœ… Infrastructure Destroyed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Environment:** ${{ github.event.inputs.environment }}" >> $GITHUB_STEP_SUMMARY
          echo "**Destroyed at:** $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ—‘ï¸ Destroyed Resources:" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… AKS Cluster" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Azure Container Registry" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Virtual Network & Subnets" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Network Security Groups" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… SQL Server & Database" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Application Gateway & WAF" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Application Insights" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Log Analytics Workspace" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… All Public IPs" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Disk Snapshots" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… SQL LTR Backups" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… Preserved Resources:" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ”’ Terraform Backend (tfstatetx02)" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ”’ terraform-state-rg" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¡ **You can rebuild infrastructure anytime using the terraform-apply workflow**" >> $GITHUB_STEP_SUMMARY

  destroy-bootstrap:
    name: ðŸ”¥ Destroy Terraform Backend
    runs-on: ubuntu-latest
    needs: destroy-infrastructure
    if: github.event.inputs.destroy_bootstrap == 'true'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Extract Azure Credentials
        id: azure-creds
        run: |
          echo "CLIENT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientId')" >> $GITHUB_OUTPUT
          echo "CLIENT_SECRET=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.clientSecret')" >> $GITHUB_OUTPUT
          echo "TENANT_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.tenantId')" >> $GITHUB_OUTPUT
          echo "SUBSCRIPTION_ID=$(echo '${{ secrets.AZURE_CREDENTIALS }}' | jq -r '.subscriptionId')" >> $GITHUB_OUTPUT
      
      - name: Azure CLI Login
        run: |
          az login --service-principal \
            -u "${{ steps.azure-creds.outputs.CLIENT_ID }}" \
            -p "${{ steps.azure-creds.outputs.CLIENT_SECRET }}" \
            --tenant "${{ steps.azure-creds.outputs.TENANT_ID }}"
          
          az account set --subscription "${{ steps.azure-creds.outputs.SUBSCRIPTION_ID }}"
      
      - name: Delete Storage Account
        run: |
          echo "ðŸ—‘ï¸ Deleting Storage Account..."
          
          if az storage account show --name ${{ env.STORAGE_ACCOUNT }} --resource-group ${{ env.RESOURCE_GROUP }} &>/dev/null; then
            az storage account delete \
              --name ${{ env.STORAGE_ACCOUNT }} \
              --resource-group ${{ env.RESOURCE_GROUP }} \
              --yes
            echo "âœ… Storage Account deleted"
          else
            echo "âš ï¸ Storage Account not found"
          fi
      
      - name: Delete Resource Group
        run: |
          echo "ðŸ—‘ï¸ Deleting Resource Group..."
          
          if az group show --name ${{ env.RESOURCE_GROUP }} &>/dev/null; then
            az group delete \
              --name ${{ env.RESOURCE_GROUP }} \
              --yes \
              --no-wait
            echo "âœ… Resource Group deletion initiated"
          else
            echo "âš ï¸ Resource Group not found"
          fi
      
      - name: Bootstrap Destroy Summary
        run: |
          echo "## ðŸ”¥ Terraform Backend Destroyed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Storage Account:** ${{ env.STORAGE_ACCOUNT }}" >> $GITHUB_STEP_SUMMARY
          echo "**Resource Group:** ${{ env.RESOURCE_GROUP }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âš ï¸ **Next steps:**" >> $GITHUB_STEP_SUMMARY
          echo "1. Run bootstrap workflow to recreate backend" >> $GITHUB_STEP_SUMMARY
          echo "2. Then run terraform-apply to recreate infrastructure" >> $GITHUB_STEP_SUMMARY

